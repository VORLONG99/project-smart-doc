---
name: "project-smart-doc"
description: "深度分析并自动维护项目文档的智能助手。具备代码注释挖掘、技术债务识别、配置分析及自动变更记录功能。"
---

# Project Smart Documentation

这个 Skill 旨在通过深度代码分析，自动维护项目的高质量文档。它不仅关注项目结构，更致力于挖掘代码中的“隐性知识”、技术债务和关键注意事项。

## 功能描述

### 1. 深度项目初始化与分析 (Deep Project Initialization & Analysis)

**触发条件**:

- 用户首次调用此 Skill。
- 用户明确要求“初始化文档”、“深度分析项目”或“生成项目概览”。

**执行动作**:

1.  **通读与架构识别**:
    - 扫描项目文件结构，识别项目类型（如 React, Vue, Node.js, Python 等）。
    - 定位入口文件（Entry Points）和核心配置文件。
2.  **依赖与环境分析**:
    - 解析 `package.json`, `requirements.txt`, `go.mod` 等依赖文件，列出**核心技术栈**及其版本。
    - 分析 `.env.example`, `docker-compose.yml` 或配置文件夹，总结**环境变量配置**和**环境依赖**（如数据库、Redis 等）的注意事项。
3.  **隐性知识挖掘 (关键步骤)**:
    - **扫描特殊注释**: 全局搜索代码中的 `TODO`, `FIXME`, `HACK`, `NOTE`, `XXX`, `DEPRECATED` 标记。
    - 将这些注释按模块或文件汇总，识别出项目中的**技术债务**、**待修复问题**和**不仅要处理的复杂逻辑**。
4.  **生成深度概览**: 在 `doc` 文件夹中创建或更新 `project_overview.md`。
    - **内容应包含**:
      - **项目简介与架构图**: 高层级的设计说明。
      - **核心技术栈**: 关键库与版本。
      - **关键配置与环境**: 运行项目的前置条件。
      - **目录结构说明**: 核心目录的职责。
      - **现有技术债务与风险**: 基于 `FIXME`/`HACK` 注释的汇总。
      - **开发注意事项**: 基于 `NOTE` 注释和配置分析得出的重点。

### 2. 智能捕获与动态更新 (Smart Capture & Dynamic Update)

**触发条件**:

- **显式触发**: 用户输入“需要特别注意的”、“注意一下”、“特别的是”、“关键点在于”等关键词。
- **隐式触发**: 用户在对话中解释了复杂的业务逻辑、指出了某个 Bug 的根本原因（Root Cause）、或者纠正了 AI 的某个错误认知。

**执行动作**:

1.  **提取与提炼**: 提取用户强调的核心逻辑、坑点或业务规则。
2.  **智能更新**:
    - 检查 `doc/attention_points.md`（项目注意事项汇总）。如果不存在，请创建。
    - **特别说明**: 此文件专门用于存储业务逻辑细节、坑点、特殊配置说明等**注意事项**，绝对**不要**将提交记录写入此文件。
    - 如果是一条全新的注意事项，**追加**并标注日期。
    - 如果是对现有认知的修正，**修改**原有条目，并标记“已更新”。
    - 如果涉及特定的代码模块，建议在条目中引用相关文件路径。

### 3. 提交变更智能概览 (Smart Commit Overview)

**触发条件**:

- 用户准备提交代码（Commit）或完成了一次较大的代码生成任务。
- **并且**满足以下任一条件：
  - 代码变动行数超过 100 行。
  - 变动的文件数量超过 3 个。
  - 用户明确要求“总结这次改动”或“生成提交记录”。

**执行动作**:

1.  **差异分析**: 分析 Git Diff 或文件变更，识别核心改动（Feature, Fix, Refactor）。
2.  **生成概览**: 在 `doc/commit_history.md` 中追加记录。如果不存在，请创建。
    - **特别说明**: 此文件专门用于存储代码变更记录、版本迭代概览，绝对**不要**将业务注意事项写入此文件。
    - **格式要求**:

      ```markdown
      ## [YYYY-MM-DD] <简短的变更标题>

      - **类型**: [Feature/Fix/Refactor]
      - **核心变更**:
        - <模块A>: <具体改动描述>
        - <模块B>: <具体改动描述>
      - **注意事项**: <本次修改引入的新约束或潜在风险> (如果有)
      - **影响文件**: <主要受影响的文件列表>
      ```

### 4. 复杂逻辑与算法深度剖析 (Deep Logic & Algorithm Analysis)

**触发条件**:

- **显式触发**: 用户要求“分析核心逻辑”、“解释这段复杂的算法”、“总结项目难点”。
- **隐式触发**: 当 AI 在阅读代码时发现了非传统的实现方式、Monkey Patch、复杂的正则表达式、自定义的中间件机制或反直觉的优化手段。

**执行动作**:

1.  **深度挖掘**:
    - 不只是解释“代码做了什么”，而是要解释“**为什么这么做**”（Rationale）。
    - 分析潜在的边界条件（Edge Cases）和副作用（Side Effects）。
2.  **更新文档**:
    - 在 `doc` 文件夹中创建或更新 `core_logic.md`。
    - **内容结构**:

      ```markdown
      ## [模块名称] 核心逻辑分析

      - **背景**: 为什么要实现这个逻辑？
      - **实现机制**: 流程图或伪代码描述。
      - **关键代码**: 引用关键函数或类。
      - **特殊处理**: 这里有哪些 Hack 或优化？
      ```

### 5. 迁移与重构向导 (Migration & Refactoring Guide)

**触发条件**:

- 用户提及关键词：“项目迁移”、“重构”、“升级到 vX”、“切换数据库”、“技术栈改造”。
- 用户询问：“如何重构这个模块？”、“迁移需要注意什么？”。

**执行动作**:

1.  **现状与目标分析**: 明确当前的实现方式和用户期望达到的目标状态。
2.  **制定计划**: 生成分步骤的迁移或重构计划，包括前置准备、执行步骤和回滚策略。
3.  **更新文档**:
    - 在 `doc` 文件夹中创建或更新 `migration_guide.md`（针对迁移）或 `refactoring_notes.md`（针对重构）。
    - **记录要点**:
      - **关键变更点**: 哪些 API 或数据结构会发生变化？
      - **兼容性风险**: 哪些旧代码可能会失效？
      - **数据迁移策略**: 数据库表结构变更如何处理？
      - **验证清单**: 如何测试重构后的功能？

### 6. Skill 自我进化与升级 (Self-Evolution & Upgrade)

**触发条件**:

- **显式触发**: 用户指令“升级一下这个 Skill”、“改进文档生成逻辑”、“添加一个新的文档规则”。
- **隐式触发**: 当用户反复纠正 Skill 的行为（例如“不要把这个写在这里”），或者指出 Skill 的某个功能不好用时。

**执行动作**:

1.  **分析需求**:
    - 理解用户希望改变 Skill 的哪个行为（是触发条件、执行动作、还是文档格式？）。
    - 定位到 `SKILL.md` 中对应的规则模块。
2.  **自我修改**:
    - **读取**: 读取当前项目 `.trae/skills/project-smart-doc/SKILL.md` 的内容。
    - **编辑**: 使用 `search_replace` 或 `write` 工具，直接修改 `SKILL.md` 文件，增加新的规则或优化现有逻辑。
    - **同步**: 修改完成后，告知用户 Skill 已升级，新的规则将在下一次对话中生效。
3.  **记录变更**:
    - 在 `SKILL.md` 的文件末尾或注释中，简要记录本次升级的内容和原因，形成 Skill 的“成长日志”。

## 文档结构规范

建议 `doc` 文件夹保持以下结构：

- `project_overview.md`: 项目宏观概述、技术栈、环境配置、**技术债务汇总**。
- `attention_points.md`: **动态维护**的业务逻辑细节、坑点、特殊配置说明。
- `commit_history.md`: 结构化的重大变更记录。
- `core_logic.md`: **[新增]** 复杂算法、非传统实现、核心机制的深度剖析。
- `migration_guide.md` / `refactoring_notes.md`: **[新增]** 大型改造项目的路线图和避坑指南。
- `api_docs.md` (可选): 如果项目中包含 API 定义，可在此维护。

## 📈 Skill 成长日志 (Evolution Log)

> 记录 Skill 的自我进化历程。

- **[2024-06-18] 初始版本**: 实现了文档初始化、注意事项捕获、提交记录生成功能。
- **[2024-06-18] 功能增强**: 增加了复杂逻辑深度剖析和迁移/重构向导功能。
- **[2024-06-18] 能力觉醒**: 增加了 Self-Evolution 自我进化能力，允许动态修改规则。
